---
sidebar_position: 1
sidebar_label: "Основная информация"
---

# @twa.js/sdk

<LibraryBadges pkg={'@twa.js/sdk'}/>

Библиотека, предназначенная упростить взаимодействие с функционалом платформы Telegram Web Apps, которая предоставляет небольшой набор компонентов, каждый из которых ответственен за свою часть утилит платформы.

Перед использованием SDK рекомендуется ознакомиться с документацией [платформы](../../introduction/about-platform.md), для укрепления своих знаний о ней, а также для улучшения понимания устройства библиотеки.

## Установка

<NpmInstall pkg={'@twa.js/sdk'}/>

## Инициализация

Ввиду того что SDK предоставляет полный контроль над циклом своей работы, важно понимать, как происходит инициализация. Библиотека предоставляет набор компонентов, которые изначально не являются инициализированными, и эта задача ложится на плечи разработчиков: они должны создать компоненты самостоятельно.

Для упрощения этого процесса SDK предоставляет такую функцию как `init`, которая возвращает инициализированные и готовые к работе экземпляры всех компонентов. Так как процесс инициализации является асинхронным, функция возвращает `Promise` с объектом, в котором представлены все инициализированные компоненты SDK:

```typescript
import { init } from '@twa.js/sdk';

init().then(components => {
  const { mainButton, viewport } = components;

  mainButton.on('click', () => viewport.expand());

  mainButton
    .setBackgroundColor('#ff0000')
    .setTextColor('#ffffff')
    .setText('Expand')
    .enable()
    .show();
});
```

### Опции

Функция `init` принимает объект, представляющий собой опции инициализации. Каждая поле в этом объекте является опциональным, равно как и сам объект:

```typescript
import {init} from '@twa.js/sdk';

init(options);
```

#### `debug: boolean`

Включает режим отладки, который приводит к выводу дополнительных сообщений, связанных с работой SDK в консоль.

#### `launchParams: string | URLSearchParams | LaunchParams`

Позволяет передавать параметры запуска, которые должны быть использованы функцией `init`. В случае если этот параметр не указан, `init` использует функцию `retrieveLaunchParams`.

#### `checkCompat: boolean`

Включает режим, при котором вызовы методов Telegram Web Apps, не поддерживаемых текущей версией устройства приведут к выбросу ошибки. Этот режим рекомендован к использованию и включен по умолчанию.

#### `cssVars: boolean`

Создает глобальные CSS-переменные, связанные с текущими параметрами темы, а также цветами приложения TWA (заголовка и тела). Созданные переменные автоматически обновляются исходя из изменений в связанных с ними параметрах темы или цветах приложения.

Переменные TWA:

- `--tg-bg-color`
- `--tg-header-color`

Переменные параметров темы:

- `--tg-theme-bg-color`
- `--tg-theme-button-color`
- `--tg-theme-button-text-color`
- `--tg-theme-hint-color`
- `--tg-theme-link-color`
- `--tg-theme-secondary-bg-color`
- `--tg-theme-text-color`

#### `targetOrigin: string`

Задает глобальный target origin, который используется функцией `postEvent` пакета bridge. Это значение ограничивает список родительских iframe, которым разрешено получать информацию от текущего веб-приложения. Подробнее об этой опции можно узнать в [этой документации](../twa-js-bridge#target-origin).

#### `timeout: number`

*Значение по умолчанию: 1000*

Длительность в миллисекундах в течение которой должна быть завершена инициализация. В случае достижения таймаута будет выброшена ошибка.

## Параметры запуска

Параметрами запуска называются начальные параметры, переданные веб-приложению. Подробнее о них можно почитать [здесь](../../launch-params/about).

Разработчики могут получить параметры запуска при помощи вызова функции `retrieveLaunchParams`. Эта функция обрабатывает все query-параметры, который начинаются с префикса `tgWebApp`.

```typescript
import { retrieveLaunchParams } from '@twa.js/sdk';

console.log(retrieveLaunchParams());

// Вывод:
// {
//   version: '6.4',
//   initData: {
//     authDate: Mon Feb 20 2023 04:11:25 GMT+0000,
//     hash: 'kSJkn101-)S(djn1',
//   },
//   initDataRaw: 'auth_data=1672893897&hash=kSJkn101-)S(djn1'
//   platform: 'android',
//   themeParams: {
//     backgroundColor: '#ffaabb',
//     buttonColor: '#223112',
//     buttonTextColor: '#111aa3',
//     hintColor: '#000000',
//     linkColor: '#ffffff',
//     secondaryBackgroundColor: '#aaaaaa',
//     textColor: '#bbbbbb',
//   },
// };
```

Эта функция не требует инициализации SDK. Она пытается извлечь параметры запуска из `window.location`. В случае, если они отсутствуют, либо невалидны, функция попытается извлечь их из `sessionStorage`. Эту функцию можно безопасно использовать даже в случае нажатия пользователем кнопки `Перезагрузить страницу`.

## Определение текущей среды

Иногда возникают случаи, когда необходимо проверить, является ли текущая среда Telegram Web Apps. Для определения случаев, когда текущей средой является TWA, разработчик может использовать функцию `isTWA`:

```typescript
import { isTWA } from '@twa.js/sdk';

console.log(isTWA()); // true или false
```

:::info

`isTWA` использует функцию `retrieveLaunchParams`, которая пытается извлечь параметры запуска из текущей среды.

:::

## Компоненты

Подразумевается, что все компоненты в этом пакете должны использоваться как синглтоны. Это означает, что разработчик не должен создавать множество экземпляров одного и того же компонента и использовать их, несмотря на то, что явно это не запрещено. Тем не менее в этом случае нет гарантии, что работа SDK не будет нарушена.

Причина этого заключается в том, что каждый компонент хранит своё собственное состояние, и экземпляры одного класса не синхронизированы друг меж другом. Например, если разработчик создаст 2 экземпляра класса `Popup` и один из них вызовет метод `open()`, это изменит его свойство `isOpened` на `true`. Тем не менее второй экземпляр `Popup` об этом не знает и будет возвращать для этого же поля значение `false`.

Во избежание возможных проблем, разработчики могут полагаться на функцию `init`, которая предоставляет инициализированные компоненты, готовые к использованию во всём приложении.

### События

Экземпляры компонентов используют стандартный способ прослушивания событий при помощи методов `on` и `off`. Пример использования на компоненте `BackButton`:

```typescript
import { BackButton } from '@twa.js/sdk';

const backButton = new BackButton(...);

backButton.on('click', () => {
  console.log('Back button clicked.');
});
```

Вы можете найти список поддерживаемых событий в собственной документации каждого компонента.

### Поддержка методов

Практически каждый компонент обладает возможность проверки поддержки своих методов. Для того чтобы проверить, поддерживается ли метод, разработчик должен использовать метод экземпляра `supports()`. Например:

```typescript
import { BackButton } from '@twa.js/sdk';

let backButton = new BackButton('6.0');
console.log(backButton.supports('show')); // false

backButton = new BackButton('6.3');
console.log(backButton.supports('hide')); // true
```

Этот метод рекомендуется использовать перед вызовом методов Telegram Web Apps, так как только в таком случае разработчик может быть уверен, что он будет выполнен как это требуется.

Список поддерживаемых методов для проверки также описан в документации к каждому компоненту.
