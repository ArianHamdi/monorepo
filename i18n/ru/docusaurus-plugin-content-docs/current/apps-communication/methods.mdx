---
sidebar_position: 2
---

# Методы

Методы это события, которые выполняют какое-либо действие. Они всегда вызываются
приложением TWA.

## Веб-версия

Так как веб-версия Telegram отображает приложение TWA в HTML-теге `<iframe/>`,
оно использует стандартный способ общения между двумя фреймами - при помощи
отправки сообщений посредством вызова функции `window.parent.postMessage`.

Первым параметром необходимо передавать объект JSON **приведенный к строке**.
Этот объект должен иметь следующий интерфейс:

```typescript
interface MessageJSON {
  eventType: string;
  eventData: any;
}
```

Вторым параметром является строка, которая описывает допустимый origin
родительского фрейма.

:::caution

Мы рекомендуем избегать использования значения `*` ввиду
того, что это не безопасно. Ваше приложение может быть обёрнуто во фрейм
злоумышленника, чего оно не узнает продолжив общаться с ним ввиду игнорирования
родительского origin.

Как значение по умолчанию, вы можете использовать `https://web.telegram.org`.

:::

Как могло быть подмечено ранее, название каждого метода описывается при
помощи свойства `eventType` и связанных параметров, находящихся в свойстве
`eventData`.

```typescript title="Пример корректной отправки данных"
window.parent.postMessage(JSON.stringify({
  eventType: 'web_app_setup_back_button',
  eventData: {is_visible: true},
}), 'https://web.telegram.org');
```

Код выше сообщит нативному приложению о том, что необходимо показать
кнопку **Back Button**. Мы опишем что это за кнопка в следующих секциях
документации.

## Десктопная и мобильная версии

В отличие от веб-версии, десктопная и мобильная используют чуть более
необычный способ вызова методов. Обе из платформ создают специальную глобальную
функцию `window.TelegramWebviewProxy.postEvent(eventType: string, eventData: string)`.

Первый аргументом передаётся наименование вызываемого метода, вторым - объект
со связанными параметрами, приведенный к строке.

```typescript title="Пример корректной отправки данных"
window.TelegramWebviewProxy.postEvent('web_app_setup_back_button', JSON.stringify({
  is_visible: true
}));
```

## Windows Phone

Нативное приложение Telegram на Windows Phone создает функцию `window.external.notify(message: string)`.
В качестве первого параметра необходимо передавать объект, описанный в разделе
для [веб-версии Telegram](#веб-версия), приведенный к строке.

```typescript title="Пример корректной отправки данных"
window.external.notify(JSON.stringify({
  eventType: 'web_app_setup_back_button',
  eventData: {is_visible: true},
}))
```

## Доступные методы

Эта секция содержит список доступных для вызова методов, включая их
наименование, описание и параметры. Заголовок секции указывает на то, начиная
с какой версии содержащиеся внутри секции методы становятся доступными.

В случае, если приложение TWA пытается вызвать метод, которого не существует в
текущей версии Telegram Web Apps, ничего не произойдет. Нативное приложение
никак не сигнализирует о том, что вызван неизвестный метод.

### v6.0

#### `iframe_ready`

Уведомляет родительский фрейм о том, что текущий фрейм готов к работе. Этот
метод используется только веб-версией Telegram и как результат вызова,
будет получено событие [`set_custom_style`](events#set_custom_style)

#### `web_app_close`

Закрывает приложение TWA.

#### `web_app_data_send`

Отправляет сервисное сообщение боту, длина которого не должна превышать 4096 байт.

Для получения большей информации касательно отправляемых данных, обратите
внимание на поле `web_app_data` в классе [`Message`](https://core.telegram.org/bots/api#message).

:::caution

После вызова метода приложение TWA будет закрыто.

:::

| Поле | Тип      | Описание                                                 |
|------|----------|----------------------------------------------------------|
| data | `string` | Данные для отправки боту. Максимальный размер 4096 байт. |

#### `web_app_expand`

Максимизирует [вьюпорт](../features/viewport) приложения TWA.

#### `web_app_open_link`

Открывает ссылку в стандартном браузере приложения.

| Поле | Тип      | Описание                                                                                  |
|------|----------|-------------------------------------------------------------------------------------------|
| url  | `string` | URL для открытия. Значение должно представлять полный путь с указанием `https` протокола. |

#### `web_app_ready`

Уведомляет нативное приложение Telegram о готовности приложения TWA к
отображению. Вызов этого метода приведёт к удалению блока и загрузкой,
располагаемого поверх приложения TWA.

#### `web_app_request_theme`

Запрашивает текущую [тему](../features/theme) от нативного приложения Telegram.
Как результат, будет создано событие [`theme_changed`](events#theme_changed).

#### `web_app_request_viewport`

Запрашивает информацию о текущем [вьюпорте](../features/viewport) от нативного
приложения Telegram. Как результат, будет создано событие
[`viewport_changed`](events#theme_changed).

#### `web_app_setup_main_button`

Обновляет настройки [Main Button](../features/main-button).

| Поле                | Тип       | Описание                                                                                                                                                                                                       |
|---------------------|-----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| is_visible          | `boolean` | _Опциональный_. Должен ли Main Button быть отображен.                                                                                                                                                          |
| is_active           | `boolean` | _Опциональный_. Должен ли Main Button быть активным.                                                                                                                                                           |
| is_progress_visible | `boolean` | _Опциональный_. Необходимо ли отображать лоадер внутри Main Button. Используйте это свойство в случае, если Main Button вызывает какую-либо длительную операцию и пользователь должен быть об этом осведомлён. |
| text                | `string`  | _Опциональный_. Текст внутри Main Button.                                                                                                                                                                      |
| color               | `string`  | _Опциональный_. Фоновый цвет Main Button в формате `#RRGGBB`.                                                                                                                                                  |
| text_color          | `string`  | _Опциональный_. Цвет текста Main Button в формате `#RRGGBB`.                                                                                                                                                   |

#### `web_app_setup_closing_behavior`

Устанавливает [поведение закрытия](../features/closing-behavior) приложения.

| Поле              | Тип       | Описание                                                         |
|-------------------|-----------|------------------------------------------------------------------|
| need_confirmation | `boolean` | Необходимо ли запрашивать подтверждение закрытия у пользователя. |

### v6.1

#### `web_app_open_tg_link`

Открывает ссылку Telegram.

:::caution

После вызова метода приложение TWA будет закрыто.

:::

| Поле      | Тип      | Описание                                                                                                                        |
|-----------|----------|---------------------------------------------------------------------------------------------------------------------------------|
| path_full | `string` | Должно быть значением из ссылки следующего формата: `https://t.me/{path_full}`. Значение может также содержать query-параметры. |

#### `web_app_open_invoice`

Открывает платежный счёт при помощи указанного идентификатора. Более подробную
информацию о счетах можно найти в этой [документации](https://core.telegram.org/bots/payments).


| Поле | Тип      | Описание                                   |
|------|----------|--------------------------------------------|
| slug | `string` | Уникальный идентификатор платежного счёта. |

#### `web_app_setup_back_button`

Обновляет настройки [Back Button](../features/back-button).

| Поле       | Тип       | Описание                              |
|------------|-----------|---------------------------------------|
| is_visible | `boolean` | Должен ли Back Button быть отображен. |

#### `web_app_set_background_color`

Обновляет [фоновый цвет](../features/theme#background-and-header-colors) приложения TWA.

| Поле  | Тип      | Описание                                         |
|-------|----------|--------------------------------------------------|
| color | `string` | Фоновый цвет приложения TWA в формате `#RRGGBB`. |

#### `web_app_set_header_color`

Обновляет [цвет шапки](../features/theme#background-and-header-colors) приложения TWA.

| Поле      | Тип      | Описание                                                                        |
|-----------|----------|---------------------------------------------------------------------------------|
| color_key | `string` | Ключ цвета шапки приложения TWA. Значения: `bg_color` или `secondary_bg_color`. |

#### `web_app_trigger_haptic_feedback`

Создаёт событие [тактильного отклика](../features/haptic-feedback).

<table>
  <thead>
  <tr>
    <th>Поле</th>
    <th>Тип</th>
    <th>Описание</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td>type</td>
    <td>
      <code>string</code>
    </td>
    <td>
      <p>Тип события тактильного отклика. Значения:</p>
      <ul>
        <li>
          <code>impact</code>
        </li>
        <li>
          <code>notification</code>
        </li>
        <li>
          <code>selection_change</code>
        </li>
      </ul>
    </td>
  </tr>
  <tr>
    <td>impact_style</td>
    <td>
      <code>string</code>
    </td>
    <td>
      <p>
        Обязателен в случае, когда <code>type</code> равен <code>impact</code>.
        Значения:
      </p>
      <ul>
        <li>
          <code>light</code>
          , сигнализирует о соприкосновении <b>малых</b> объектов UI
        </li>
        <li>
          <code>medium</code>
          , сигнализирует о соприкосновении <b>средних</b> объектов UI
        </li>
        <li>
          <code>heavy</code>
          , сигнализирует о соприкосновении <b>больших</b> объектов UI
        </li>
        <li>
          <code>rigid</code>
          , сигнализирует о
          соприкосновении <b>тяжелых</b> или <b>негибких</b> объектов UI
        </li>
        <li>
          <code>soft</code>
          , сигнализирует о
          соприкосновении <b>лёгких</b> или <b>гибких</b> объектов UI
        </li>
      </ul>
    </td>
  </tr>
  <tr>
    <td>notification_type</td>
    <td>
      <code>string</code>
    </td>
    <td>
      <p>
        Обязателен в случае,
        когда <code>type</code> является <code>notification</code>. Значения:
      </p>
      <ul>
        <li>
          <code>error</code>
          , сообщает о том, что событие провалилось
        </li>
        <li>
          <code>success</code>
          , сообщает о том, что событие успешно выполнилось
        </li>
        <li>
          <code>warning</code>
          , сообщает о том, что событие произвело предупреждение
        </li>
      </ul>
    </td>
  </tr>
  </tbody>
</table>

### v6.2

#### `web_app_open_popup`

Открывает новое [всплывающее окно](../features/popup). В случае его закрытия,
будет произведено событие [`popup_closed`](events#popup_closed).

<table style={{marginTop: -10}}>
  <thead>
  <tr>
    <th>Поле</th>
    <th>Тип</th>
    <th>Описание</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td>title</td>
    <td>
      <code>string</code>
    </td>
    <td>Текст для отображения в заголовке всплывающего окна. От 0 до 64
      символов.
    </td>
  </tr>
  <tr>
    <td>message</td>
    <td>
      <code>string</code>
    </td>
    <td>
      Сообщение для отображения в теле всплывающего окна. От 1 до 256 символов.
    </td>
  </tr>
  <tr>
    <td>buttons</td>
    <td>
      <a href={'#popupbutton'}>
        <code>PopupButton[]</code>
      </a>
    </td>
    <td>Список кнопок для отображения внутри всплывающего окна. От 1 до 3
      кнопок.
    </td>
  </tr>
  </tbody>
</table>

##### `PopupButton`

<table style={{marginTop: -10}}>
  <thead>
  <tr>
    <th>Поле</th>
    <th>Тип</th>
    <th>Описание</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td>id</td>
    <td>
      <code>string</code>
    </td>
    <td>Идентификатор кнопки. От 0 до 64 символов.</td>
  </tr>
  <tr>
    <td>type</td>
    <td>
      <code>string</code>
    </td>
    <td>
      <p>Тип кнопки. Значения:</p>
      <ul>
        <li>
          <code>default</code>
          , кнопка со стандартным стилем
        </li>
        <li>
          <code>destructive</code>
          , кнопка, которая указывает на деструктивное действие (например,
          "Удалить")
        </li>
        <li>
          <code>ok</code>
          , кнопка с локализованным текстом "OK"
        </li>
        <li>
          <code>close</code>
          , кнопка с локализованным текстом "Закрыть"
        </li>
        <li>
          <code>cancel</code>
          , кнопка с локализованным текстом "Отменить"
        </li>
      </ul>
    </td>
  </tr>
  <tr>
    <td>text</td>
    <td>
      <code>string</code>
    </td>
    <td>
      <p>Текст для отображения внутри кнопки. От 0 до 64 символов.</p>
      <p>
        <i>Игнорируется</i>
        &nbsp;
        когда <code>type</code> равен <code>ok</code>, <code>close</code> или
        <code>cancel</code>.
      </p>
    </td>
  </tr>
  </tbody>
</table>

### v6.4

#### `web_app_open_scan_qr_popup`

Открывает сканнер QR-кодов. В случае его закрытия будет создано событие
[`scan_qr_popup_closed`](events#scan_qr_popup_closed). Если сканнеру удалось
просканировать QR-код, будет создано событие [`qr_text_received`](events#qr_text_received).

| Поле | Тип      | Описание                                             |
|------|----------|------------------------------------------------------|
| text | `string` | _Опциональный_. Текст для отображения в QR-сканнере. |

#### `web_app_close_scan_qr_popup`

Закрывает QR-сканнер. Будет создано событие [`scan_qr_popup_closed`](events#scan_qr_popup_closed).

#### `web_app_read_text_from_clipboard`

Производит чтение текста из буфера обмена. Метод принимает идентификатор
запроса, который используется для корректного получения события
[`qr_text_received`](events#qr_text_received).

| Поле   | Тип      | Описание                                                                                          |
|--------|----------|---------------------------------------------------------------------------------------------------|
| req_id | `string` | Уникальный локальный идентификатор запроса. Используется сугубо для получения связанного события. |

