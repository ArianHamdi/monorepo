"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[284],{7522:(t,e,n)=>{n.d(e,{Zo:()=>p,kt:()=>k});var a=n(9901);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(t,e){if(null==t)return{};var n,a,r=function(t,e){if(null==t)return{};var n,a,r={},l=Object.keys(t);for(a=0;a<l.length;a++)n=l[a],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)n=l[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var u=a.createContext({}),s=function(t){var e=a.useContext(u),n=e;return t&&(n="function"==typeof t?t(e):i(i({},e),t)),n},p=function(t){var e=s(t.components);return a.createElement(u.Provider,{value:e},t.children)},d="mdxType",c={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},h=a.forwardRef((function(t,e){var n=t.components,r=t.mdxType,l=t.originalType,u=t.parentName,p=o(t,["components","mdxType","originalType","parentName"]),d=s(n),h=r,k=d["".concat(u,".").concat(h)]||d[h]||c[h]||l;return n?a.createElement(k,i(i({ref:e},p),{},{components:n})):a.createElement(k,i({ref:e},p))}));function k(t,e){var n=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var l=n.length,i=new Array(l);i[0]=h;var o={};for(var u in e)hasOwnProperty.call(e,u)&&(o[u]=e[u]);o.originalType=t,o[d]="string"==typeof t?t:r,i[1]=o;for(var s=2;s<l;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},243:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>u,contentTitle:()=>i,default:()=>c,frontMatter:()=>l,metadata:()=>o,toc:()=>s});var a=n(3223),r=(n(9901),n(7522));const l={sidebar_position:2},i="Init data",o={unversionedId:"launch-params/init-data",id:"launch-params/init-data",title:"Init data",description:"Description",source:"@site/docs/launch-params/init-data.mdx",sourceDirName:"launch-params",slug:"/launch-params/init-data",permalink:"/docs/launch-params/init-data",draft:!1,editUrl:"https://github.com/twa-dev/docs/tree/master/docs/launch-params/init-data.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"sidebar",previous:{title:"Common information",permalink:"/docs/launch-params/about"},next:{title:"Closing behavior",permalink:"/docs/functionality/closing-behavior"}},u={},s=[{value:"Description",id:"description",level:2},{value:"Extraction",id:"extraction",level:2},{value:"Authorization and authentication",id:"authorization-and-authentication",level:2},{value:"Sending to server",id:"sending-to-server",level:2},{value:"Parameters list",id:"parameters-list",level:2},{value:"Other types",id:"other-types",level:2},{value:"Chat",id:"chat",level:3},{value:"User",id:"user",level:3}],p={toc:s},d="wrapper";function c(t){let{components:e,...n}=t;return(0,r.kt)(d,(0,a.Z)({},p,n,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"init-data"},"Init data"),(0,r.kt)("h2",{id:"description"},"Description"),(0,r.kt)("p",null,"In the list of ",(0,r.kt)("a",{parentName:"p",href:"/docs/launch-params/about"},"launch parameters"),", initialization data is located in\nthe ",(0,r.kt)("inlineCode",{parentName:"p"},"tgWebAppData")," parameter. They are a set of data mostly\nrelated to a specific user who launched the TWA application."),(0,r.kt)("p",null,"A striking feature of init data is the fact that they can\nbe used as an authentication or authorization factor. For this reason\n, do not forget about the security of the application."),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"This parameter will be missing in case, TWA application was opened via\nKeyboardButton (keyboard in the dialogue with user).")),(0,r.kt)("h2",{id:"extraction"},"Extraction"),(0,r.kt)("p",null,"To extract init data, it is required to firstly get the launch parameters,\nthen extract parameter with name ",(0,r.kt)("inlineCode",{parentName:"p"},"tgWebAppData")," and pass it to the\n",(0,r.kt)("inlineCode",{parentName:"p"},"URLSearchParams")," constructor:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Example of a processed value"',title:'"Example',of:!0,a:!0,processed:!0,'value"':!0},"// Get launch parameters.\nconst params = new URLSearchParams(window.location.hash.slice(1));\n\n// Convert it to more user-friendly object.\nconst initDataString = params.get('tgWebAppData'); // user=...&query_id=...&...\nconst initData = new URLSearchParams(initDataString);\nconsole.log(initData.get('query_id')); // jsHS198czozxk7s \n")),(0,r.kt)("h2",{id:"authorization-and-authentication"},"Authorization and authentication"),(0,r.kt)("p",null,"A special feature of initialization data is the ability to be used as a factor\nfor authorization or authentication. The fact is that the data generated by the\nnative Telegram application is signed with the secret key of the Telegram bot,\nafter which the generated signature is placed next to the parameters themselves."),(0,r.kt)("p",null,"Thus, knowing the secret key of the Telegram bot, the developer has the\nopportunity to verify the signature of the parameters and make sure that\nthey were indeed issued to the specified user."),(0,r.kt)("p",null,"Also, the signature verification operation is fast enough and does not require\nlarge server resources. More information about the data signature and\nverification algorithm can be found in\n",(0,r.kt)("a",{parentName:"p",href:"https://core.telegram.org/bots/webapps#validating-data-received-via-the-web-app"},"this"),"\ndocumentation."),(0,r.kt)("h2",{id:"sending-to-server"},"Sending to server"),(0,r.kt)("p",null,"In order to authorize the user on the server, the developer needs to transmit\nthe initialization data that was specified when launching the TWA application.\nTo make life easier for yourself, the developer can transmit them at each\nrequest to the server, after which the signature verification is carried out\non the server side."),(0,r.kt)("p",null,"Here comes the example with the usage of such library as ",(0,r.kt)("inlineCode",{parentName:"p"},"axios"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Example of passing init data"',title:'"Example',of:!0,passing:!0,init:!0,'data"':!0},"import axios from 'axios';\n\nconst initData = new URLSearchParams(window.location.hash.slice(1))\n  .get('tgWebAppData');\n\nif (initData === null) {\n  throw new Error('Ooof! Something is wrong. Init data is missing');\n}\n\n// Create axios instance.  \nconst http = axios.create({\n  headers: {\n    // Append authorization header. \n    Authorization: `twa-init-data ${initData}`,\n  }\n});\n")),(0,r.kt)("p",null,"In turn, the following actions must be performed on the server side:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Get the value of the ",(0,r.kt)("inlineCode",{parentName:"li"},"Authorization")," header;"),(0,r.kt)("li",{parentName:"ol"},"Check that the first part of it is equal to ",(0,r.kt)("inlineCode",{parentName:"li"},"twa-init-data"),";"),(0,r.kt)("li",{parentName:"ol"},"Get initialization data and verify its signature.")),(0,r.kt)("p",null,"If this algorithm is successful, the server part of the application can trust\nthe transmitted initialization data."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"In real-world applications, it is recommended to use additional mechanisms\nfor verifying initialization data. For example, add their expiration date. This\ncheck can be implemented using the ",(0,r.kt)("inlineCode",{parentName:"p"},"auth_date")," parameter, which is responsible\nfor the date when the parameters were created. This solution will allow in case\nof theft of initialization data to prevent their constant use by an attacker.")),(0,r.kt)("h2",{id:"parameters-list"},"Parameters list"),(0,r.kt)("p",null,"This section provides a complete list of parameters used in initialization data."),(0,r.kt)("table",null,(0,r.kt)("thead",null,(0,r.kt)("tr",null,(0,r.kt)("th",null,"Parameter"),(0,r.kt)("th",null,"Type"),(0,r.kt)("th",null,"Description"))),(0,r.kt)("tbody",null,(0,r.kt)("tr",null,(0,r.kt)("td",null,"auth_date"),(0,r.kt)("td",null,(0,r.kt)("code",null,"number")),(0,r.kt)("td",null,"The date the initialization data was created. Is a number representing a Unix timestamp.")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"can_send_after"),(0,r.kt)("td",null,(0,r.kt)("code",null,"number")),(0,r.kt)("td",null,(0,r.kt)("i",null,"Optional"),". The number of seconds after which a message can be sent via the method",(0,r.kt)("a",{href:"https://core.telegram.org/bots/api#answerwebappquery"},"answerWebAppQuery"),".")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"chat_type"),(0,r.kt)("td",null,(0,r.kt)("code",null,"string")),(0,r.kt)("td",null,(0,r.kt)("p",null,(0,r.kt)("i",null,"Optional"),". The type of chat from which the TWA application was opened. Values:"),(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("code",null,"sender")),(0,r.kt)("li",null,(0,r.kt)("code",null,"private")),(0,r.kt)("li",null,(0,r.kt)("code",null,"group")),(0,r.kt)("li",null,(0,r.kt)("code",null,"supergroup")),(0,r.kt)("li",null,(0,r.kt)("code",null,"channel"))),(0,r.kt)("p",{style:{marginBottom:0}},"Returned only for applications opened by direct link."))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"chat_instance"),(0,r.kt)("td",null,(0,r.kt)("code",null,"string")),(0,r.kt)("td",null,(0,r.kt)("i",null,"Optional"),". A global identifier indicating the chat from which the TWA application was opened. Returned only for applications opened by direct link.")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"chat"),(0,r.kt)("td",null,(0,r.kt)("a",{href:"#chat"},(0,r.kt)("code",null,"Chat"))),(0,r.kt)("td",null,(0,r.kt)("i",null,"Optional"),". An object containing information about the chat with the bot in which the TWA application was launched. It is returned only for TWA applications opened through the attachments menu.")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"hash"),(0,r.kt)("td",null,(0,r.kt)("code",null,"string")),(0,r.kt)("td",null,"Initialization data signature.")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"query_id"),(0,r.kt)("td",null,(0,r.kt)("code",null,"string")),(0,r.kt)("td",null,(0,r.kt)("i",null,"Optional"),". The unique session ID of the TWA application. Used in the process of sending a message via the method",(0,r.kt)("a",{href:"https://core.telegram.org/bots/api#answerwebappquery"},"answerWebAppQuery"),".")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"receiver"),(0,r.kt)("td",null,(0,r.kt)("a",{href:"#user"},(0,r.kt)("code",null,"User"))),(0,r.kt)("td",null,(0,r.kt)("i",null,"Optional"),". An object containing information about the user-the interlocutor of the current user. It is returned only for private chats, as well as for TWA applications opened through the attachments menu.")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"start_param"),(0,r.kt)("td",null,(0,r.kt)("code",null,"string")),(0,r.kt)("td",null,(0,r.kt)("i",null,"Optional"),". The value of the ",(0,r.kt)("code",null,"startattach")," query parameter specified in the link. It is returned only for TWA applications opened through the attachments menu.")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"user"),(0,r.kt)("td",null,(0,r.kt)("a",{href:"#user"},(0,r.kt)("code",null,"User"))),(0,r.kt)("td",null,(0,r.kt)("i",null,"Optional"),". An object containing information about the current user.")))),(0,r.kt)("h2",{id:"other-types"},"Other types"),(0,r.kt)("h3",{id:"chat"},"Chat"),(0,r.kt)("p",null,"Describes the chat information."),(0,r.kt)("table",null,(0,r.kt)("thead",null,(0,r.kt)("tr",null,(0,r.kt)("th",null,"Property"),(0,r.kt)("th",null,"Type"),(0,r.kt)("th",null,"Description"))),(0,r.kt)("tbody",null,(0,r.kt)("tr",null,(0,r.kt)("td",null,"id"),(0,r.kt)("td",null,(0,r.kt)("code",null,"number")),(0,r.kt)("td",null,"Unique chat ID.")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"photo_url"),(0,r.kt)("td",null,(0,r.kt)("code",null,"string")),(0,r.kt)("td",null,(0,r.kt)("i",null,"Optional"),". Chat photo link. The photo can have ",(0,r.kt)("code",null,".jpeg")," and",(0,r.kt)("code",null,".svg")," formats. It is returned only for TWA applications opened through the attachments menu.")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"type"),(0,r.kt)("td",null,(0,r.kt)("code",null,"string")),(0,r.kt)("td",null,(0,r.kt)("p",null,(0,r.kt)("i",null,"Optional"),". Chat type. Values:"),(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("code",null,"group")),(0,r.kt)("li",null,(0,r.kt)("code",null,"supergroup")),(0,r.kt)("li",null,(0,r.kt)("code",null,"channel"))))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"title"),(0,r.kt)("td",null,(0,r.kt)("code",null,"string")),(0,r.kt)("td",null,"Chat title.")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"username"),(0,r.kt)("td",null,(0,r.kt)("code",null,"string")),(0,r.kt)("td",null,(0,r.kt)("i",null,"Optional"),". Chat user login.")))),(0,r.kt)("h3",{id:"user"},"User"),(0,r.kt)("p",null,"Describes information about a user or bot."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Property"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"first_name"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"string")),(0,r.kt)("td",{parentName:"tr",align:null},"Bot or user name.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"id"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"number")),(0,r.kt)("td",{parentName:"tr",align:null},"Bot or user ID.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"is_bot"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"boolean")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("em",{parentName:"td"},"Optional"),". Is the user a bot.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"is_premium"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"boolean")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("em",{parentName:"td"},"Optional"),". Has the user purchased Telegram Premium.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"last_name"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"string")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("em",{parentName:"td"},"Optional"),". User's last name.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"language_code"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"string")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("em",{parentName:"td"},"Optional"),". ",(0,r.kt)("a",{parentName:"td",href:"https://en.wikipedia.org/wiki/IETF_language_tag"},"IETF")," user's language.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"photo_url"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"string")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("em",{parentName:"td"},"Optional"),". Link to the user's or bot's photo. Photos can have formats ",(0,r.kt)("inlineCode",{parentName:"td"},".jpeg")," and `.svg'. It is returned only for TWA applications opened through the attachments menu.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"username"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"string")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("em",{parentName:"td"},"Optional"),". Login of the bot or user.")))))}c.isMDXComponent=!0}}]);